#####################################################################################################
##### NSPANEL ESPHOME created by Blackymas - https://github.com/Blackymas/NSPanel_HA_Blueprint  #####
##### ESPHOME - Page media_player                                                               #####
##### PLEASE only make changes if it is necessary and also the required knowledge is available. #####
##### For normal use with the Blueprint, no changes are necessary.                              #####
#####################################################################################################

---
substitutions:
  BOOT_STEP_PAGE_MEDIA_PLAYER: '20'
  PAGE_MEDIA_PLAYER_ID: '25'
  PAGE_NAME_MEDIA_PLAYER: "media_player"
  COMPONENT_ID_MEDIA_PLAYER_BT_VOL_DOWN: '6'
  COMPONENT_ID_MEDIA_PLAYER_BT_VOL_UP: '7'
  MEDIA_PLAYER_FEATURE_PAUSE: '1'
  MEDIA_PLAYER_FEATURE_SEEK: '2'
  MEDIA_PLAYER_FEATURE_VOLUME_SET: '4'
  MEDIA_PLAYER_FEATURE_VOLUME_MUTE: '8'
  MEDIA_PLAYER_FEATURE_PREVIOUS_TRACK: '16'
  MEDIA_PLAYER_FEATURE_NEXT_TRACK: '32'
  MEDIA_PLAYER_FEATURE_TURN_ON: '128'
  MEDIA_PLAYER_FEATURE_TURN_OFF: '256'
  MEDIA_PLAYER_FEATURE_PLAY_MEDIA: '512'
  MEDIA_PLAYER_FEATURE_VOLUME_STEP: '1024'
  MEDIA_PLAYER_FEATURE_SELECT_SOURCE: '2048'
  MEDIA_PLAYER_FEATURE_STOP: '4096'
  MEDIA_PLAYER_FEATURE_CLEAR_PLAYLIST: '8192'
  MEDIA_PLAYER_FEATURE_PLAY: '16384'
  MEDIA_PLAYER_FEATURE_SHUFFLE_SET: '32768'
  MEDIA_PLAYER_FEATURE_SELECT_SOUND_MODE: '65536'
  MEDIA_PLAYER_FEATURE_BROWSE_MEDIA: '131072'
  MEDIA_PLAYER_FEATURE_REPEAT_SET: '262144'
  MEDIA_PLAYER_FEATURE_GROUPING: '524288'
  MEDIA_PLAYER_FEATURE_MEDIA_ANNOUNCE: '1048576'
  MEDIA_PLAYER_FEATURE_MEDIA_ENQUEUE: '2097152'
  MDI_ICON_PLAY: "\uE409"                # mdi:play
  MDI_ICON_PAUSE: "\uE3E3"               # mdi:pause
  MDI_ICON_VOLUME_VARIANT_OFF: "\uEE07"  # mdi:volume-variant-off
  MDI_ICON_VOLUME_LOW: "\uE57E"          # mdi:volume-low
  TAG_PAGE_MEDIA_PLAYER: nspanel_ha_blueprint.page.media_player

esphome:
  platformio_options:
    build_flags:
      - -D NSPANEL_HA_BLUEPRINT_STANDARD_PAGE_MEDIA_PLAYER

script:
  - id: !extend event_from_display
    then:
      - lambda: |-
          if (page == "${PAGE_NAME_MEDIA_PLAYER}") {
            const std::string key = json["key"];
            if (key == "volume_mute") {
              const std::string value = json["value"];
              ha_call_action->execute("media_player.volume_mute", "is_volume_muted", value.c_str());
            } else if (key == "volume_set") {
              const float value_float = json["value"].as<float>();
              ha_call_action->execute("media_player.volume_set", "volume_level", to_string(value_float / 100.0f));
            } else if (!key.empty())
              ha_call_action->execute((std::string("media_player.") + key.c_str()), "", "");
          }

  - id: !extend page_change
    then:
      - if:
          condition:
            - lambda: return new_page_id == ${PAGE_MEDIA_PLAYER_ID};
          then:
            - script.execute: page_media_player

  - id: page_media_player
    mode: restart
    then:  # There's nothing here so far

  - id: !extend stop_page_constructors
    then:
      - script.stop: page_media_player
...
