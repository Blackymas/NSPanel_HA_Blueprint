#####################################################################################################
##### NSPANEL ESPHOME created by Blackymas - https://github.com/Blackymas/NSPanel_HA_Blueprint  #####
##### ESPHOME - Page Settings                                                                   #####
##### PLEASE only make changes if it is necessary and also the required knowledge is available. #####
##### For normal use with the Blueprint, no changes are necessary.                              #####
#####################################################################################################

---
substitutions:
  BOOT_STEP_PAGE_SETTINGS: 28
  PAGE_SETTINGS_ID: 8
  TAG_PAGE_SETTINGS: nspanel.page.settings

display:
  - id: !extend disp1
    on_touch:
      then:
        - lambda: |-
            if (
                  !touch_event and  // Only act with release
                  page_id == ${PAGE_SETTINGS_ID} and
                  component_id == 9  // Reboot button
                ) {
              screen_power->turn_off();
              App.safe_reboot();
            }

esphome:
  platformio_options:
    build_flags:
      - -D NSPANEL_HA_BLUEPRINT_PAGE_SETTINGS

number:
  - id: !extend display_brightness
    on_value:
      then:
        - lambda: |-
            disp1->set_component_value("settings.brightslider", int(x));
            if (current_page_id == ${PAGE_SETTINGS_ID})
              disp1->set_component_text_printf("bright_text", "%i%%", int(x));

  - id: !extend display_dim_brightness
    on_value:
      then:
        - lambda: |-
            disp1->set_component_value("settings.dimslider", int(x));
            if (current_page_id == ${PAGE_SETTINGS_ID})
              disp1->set_component_text_printf("dim_text", "%i%%", int(x));

script:
  - id: !extend page_change
    then:
      - lambda: |-
          if (new_page_id == ${PAGE_SETTINGS_ID})
            page_settings->execute();

  - id: page_settings
    mode: single
    then:
      - lambda: |-
          if (current_page_id == ${PAGE_SETTINGS_ID}) {
            disp1->send_command("vis lbl_sleep,0");
            disp1->send_command("vis bt_sleep,0");
          }

  - id: !extend stop_page_constructors
    then:
      - script.stop: page_settings
...
