#####################################################################################################
##### NSPANEL ESPHOME created by Blackymas - https://github.com/Blackymas/NSPanel_HA_Blueprint  #####
##### ESPHOME CORE - Base                                                                       #####
##### PLEASE only make changes if it is necessary and also the required knowledge is available. #####
##### For normal use with the Blueprint, no changes are necessary.                              #####
#####################################################################################################

---
substitutions:
  ##############################
  ## Change only in your      ##
  ## local yaml substitutions ##
  device_name: nspanel
  name: ${device_name}
  friendly_name: ${device_name}
  ota_password: ${wifi_password}
  project_tag: nspanel_ha_blueprint
  ##############################
  BOOT_STEP_BASE: '0'
  TAG_BASE: nspanel_ha_blueprint.base
  GPIO_PSRAM_CLK_PIN: '5'
  GPIO_PSRAM_CS_PIN: '18'

button:
  - id: nspanel_factory_reset  # Factory Reset button - Used to clean values from flash
    name: Factory reset
    platform: factory_reset
    internal: false
    disabled_by_default: true
    icon: mdi:restart-alert

  - id: restart_nspanel  # Reboot ESP32
    name: Restart
    platform: restart

esphome:
  name: ${name}
  friendly_name: ${friendly_name}
  comment: NSPanel HA Blueprint
  project:
    name: Blackymas.NSPanel_HA_Blueprint
    version: ${version}
  platformio_options:
    build_flags:
      - -Wno-missing-field-initializers
      - -D NSPANEL_HA_BLUEPRINT_CORE_BASE
  min_version: 2025.7.0

external_components:
  - source:
      type: git
      url: https://github.com/Blackymas/NSPanel_HA_Blueprint
      ref: v${version}
    refresh: 300s
    components:
      - nspanel_ha_blueprint

logger:

nspanel_ha_blueprint:  # Adds custom library for NSPanel HA Blueprint project
  psram_clk_pin: ${GPIO_PSRAM_CLK_PIN}
  psram_cs_pin: ${GPIO_PSRAM_CS_PIN}

ota:
  - id: ota_std
    platform: esphome
    password: ${ota_password}

safe_mode:
  num_attempts: 5
  reboot_timeout: 10min

script:
  - id: dump_config
    mode: restart
    then:
      - delay: 10s

  - id: stop_all
    mode: restart
    then:
      - script.stop: dump_config
...
