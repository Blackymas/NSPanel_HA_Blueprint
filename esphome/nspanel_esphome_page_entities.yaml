#####################################################################################################
##### NSPANEL ESPHOME created by Blackymas - https://github.com/Blackymas/NSPanel_HA_Blueprint  #####
##### ESPHOME CORE - Page Entities                                                              #####
##### PLEASE only make changes if it is necessary and also the required knowledge is available. #####
##### For normal use with the Blueprint, no changes are necessary.                              #####
#####################################################################################################

---
substitutions:
  BOOT_STEP_PAGE_ENTITIES: 15
  PAGE_ENTITYPAGE01_ID: 18
  PAGE_ENTITYPAGE02_ID: 19
  PAGE_ENTITYPAGE03_ID: 20
  PAGE_ENTITYPAGE04_ID: 21
  half_width_chars: "iljtIf '-,;:!.\\\"|()[]{}*^~\\\\/_"
  TAG_PAGE_ENTITIES: nspanel.page.entities

esphome:
  platformio_options:
    build_flags:
      - -D NSPANEL_HA_BLUEPRINT_PAGE_ENTITIES

script:
  - id: !extend global_settings
    then:
      # Entities pages alignment
      - delay: ${DELAY_DEFAULT}ms
      - lambda: |-
          ESP_LOGD("${TAG_PAGE_ENTITIES}", "Set value alignment on entities pages");
          page_entities_value_horizontal_alignment = ent_value_xcen;

  - id: !extend page_change
    then:
      - lambda: |-
          if (new_page_id == ${PAGE_ENTITYPAGE01_ID}) page_entitypage01->execute();
          else if (new_page_id == ${PAGE_ENTITYPAGE02_ID}) page_entitypage02->execute();
          else if (new_page_id == ${PAGE_ENTITYPAGE03_ID}) page_entitypage03->execute();
          else if (new_page_id == ${PAGE_ENTITYPAGE04_ID}) page_entitypage04->execute();

  - id: page_entitypage
    mode: single
    parameters:
      page_number: uint
    then:
      - lambda: |-
          // Set value alignment
          if (
                page_entities_value_horizontal_alignment != 1 and
                (
                  current_page_id == ${PAGE_ENTITYPAGE01_ID} or
                  current_page_id == ${PAGE_ENTITYPAGE02_ID} or
                  current_page_id == ${PAGE_ENTITYPAGE03_ID} or
                  current_page_id == ${PAGE_ENTITYPAGE04_ID}
                )
              ) {
            for (uint8_t i = 1; i <= 8; ++i) {
              disp1->send_command_printf("value%02d.xcen=%" PRIu8, i, page_entities_value_horizontal_alignment);
            }
          }

  - id: page_entitypage01
    mode: single
    then:
      - script.execute:
          id: page_entitypage
          page_number: 1
  - id: page_entitypage02
    mode: single
    then:
      - script.execute:
          id: page_entitypage
          page_number: 2
  - id: page_entitypage03
    mode: single
    then:
      - script.execute:
          id: page_entitypage
          page_number: 3
  - id: page_entitypage04
    mode: single
    then:
      - script.execute:
          id: page_entitypage
          page_number: 4

  - id: !extend stop_page_constructors
    then:
      - script.stop: page_entitypage
      - script.stop: page_entitypage01
      - script.stop: page_entitypage02
      - script.stop: page_entitypage03
      - script.stop: page_entitypage04
...
