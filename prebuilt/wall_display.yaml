########################
##### EXPERIMENTAL #####
########################

#####################################################################################################
##### NSPANEL ESPHOME created by Blackymas - https://github.com/Blackymas/NSPanel_HA_Blueprint  #####
##### ESPHOME PRE-BUILT - Wall_Display variation by https://github.com/MichaelHeimann           #####
##### PLEASE only make changes if it is necessary and also the required knowledge is available. #####
##### For normal use with the Blueprint, no changes are necessary.                              #####
#####################################################################################################
---
substitutions:
  device_name: "wall-display"
  friendly_name: "Wall Display"
  wifi_password: NSPanel_Wall_Display

  firmware_bin: "https://raw.githubusercontent.com/Blackymas/NSPanel_HA_Blueprint/main/prebuilt/wall_display.bin"
  firmware_manifest: "https://raw.githubusercontent.com/Blackymas/NSPanel_HA_Blueprint/main/prebuilt/wall_display.manifest.json"

  heater_relay: "1"  # Possible values: 1/2
  temp_min: "16"     # Min supported temperature is 40°F
  temp_max: "26"     # Max supported temperature is 80°F
  temp_step: "0.5"   # Temperature granularity is 1°F

packages:
  # yamllint disable rule:colons
  # Core packages
  core_package:       !include ../esphome/nspanel_esphome_core.yaml  # Core configuration for basic functionality
  standard_package:   !include ../esphome/nspanel_esphome_standard.yaml  # Standard (includes packages listed)
  ota_http:           !include ../esphome/nspanel_esphome_addon_ota_http.yaml  # Required for pre-built firmware
  addon_climate_heat: !include ../esphome/nspanel_esphome_addon_climate_heat.yaml
  # Optional (and recommended) packages
  # hw_buzzer:          !include ../esphome/nspanel_esphome_standard_hw_buzzer.yaml
  # hw_relays:          !include ../esphome/nspanel_esphome_standard_hw_relays.yaml
  # hw_temperature:     !include ../esphome/nspanel_esphome_standard_hw_temperature.yaml
  # page_alarm:         !include ../esphome/nspanel_esphome_standard_page_alarm.yaml
  # page_blank:         !include ../esphome/nspanel_esphome_standard_page_blank.yaml
  # page_buttons:       !include ../esphome/nspanel_esphome_standard_page_buttons.yaml
  # page_climate:       !include ../esphome/nspanel_esphome_standard_page_climate.yaml
  # page_confirm:       !include ../esphome/nspanel_esphome_standard_page_confirm.yaml
  # page_cover:         !include ../esphome/nspanel_esphome_standard_page_cover.yaml
  # page_entities:      !include ../esphome/nspanel_esphome_standard_page_entities.yaml
  # page_fan:           !include ../esphome/nspanel_esphome_standard_page_fan.yaml
  # page_keyb_num:      !include ../esphome/nspanel_esphome_standard_page_keyb_num.yaml
  # page_light:         !include ../esphome/nspanel_esphome_standard_page_light.yaml
  # page_media_player:  !include ../esphome/nspanel_esphome_standard_page_media_player.yaml
  # page_notification:  !include ../esphome/nspanel_esphome_standard_page_notification.yaml
  # page_qrcode:        !include ../esphome/nspanel_esphome_standard_page_qrcode.yaml
  # page_settings:      !include ../esphome/nspanel_esphome_standard_page_settings.yaml
  # page_utilities:     !include ../esphome/nspanel_esphome_standard_page_utilities.yaml
  # page_weather:       !include ../esphome/nspanel_esphome_standard_page_weather.yaml
  # upload_tft:         !include ../esphome/nspanel_esphome_standard_upload_tft.yaml
  # Optional advanced and add-on configurations
  # addon_advanced:     !include ../esphome/nspanel_esphome_advanced.yaml
  # addon_ble_tracker:  !include ../esphome/nspanel_esphome_addon_ble_tracker.yaml
  # addon_ble_proxy:    !include ../esphome/nspanel_esphome_addon_bluetooth_proxy.yaml
  # addon_climate_cool: !include ../esphome/nspanel_esphome_addon_climate_cool.yaml
  # addon_climate_heat: !include ../esphome/nspanel_esphome_addon_climate_heat.yaml
  # addon_climate_dual: !include ../esphome/nspanel_esphome_addon_climate_dual.yaml
  # addon_cover:        !include ../esphome/nspanel_esphome_addon_cover.yaml
  # yamllint enable rule:colons

captive_portal:
  id: ap_captive_portal

dashboard_import:
  package_import_url: github://Blackymas/NSPanel_HA_Blueprint/prebuilt/wall_display.yaml@main
  import_full_config: false

esp32:
  framework:
    type: esp-idf
    version: 4.4.8
    platform_version: 5.4.0

esp32_ble:
  id: ble

esp32_improv:
  id: ble_improv
  authorizer: none

esp32_ble_server:
  id: ble_server

esphome:
  name_add_mac_suffix: true
  project:
    name: esphome.Wall_Display
  platformio_options:
    build_flags:
      - -D NSPANEL_HA_BLUEPRINT_PREBUILT_WALL_DISPLAY
      - -D CONFIG_ESP32_WIFI_IRAM_OPT=0               # Avoid placing Wi-Fi code in IRAM (saves IRAM, slight speed hit)
      - -D CONFIG_ESP32_WIFI_RX_IRAM_OPT=0            # Avoid placing RX ISR code in IRAM (saves space)
      - -D CONFIG_HTTP_RECV_BUFFER_SIZE=2048          # Shrink HTTP receive buffer (saves RAM)
      - -D CONFIG_HTTP_RESPONSE_BUFFER_SIZE=2048      # Shrink HTTP response buffer (saves RAM)
      - -D CONFIG_HTTP_SEND_BUFFER_SIZE=1024          # Shrink HTTP send buffer (saves RAM)
      - -D CONFIG_MBEDTLS_ECDH_C=1                    # Keep ECDH (required for modern HTTPS key exchange)
      - -D CONFIG_MBEDTLS_ECDSA_C=1                   # Keep ECDSA (used by Let's Encrypt, etc.)
      - -D CONFIG_MBEDTLS_ECP_C=1                     # Required for elliptic curve support (used in HTTPS)
      - -D CONFIG_MBEDTLS_KEY_EXCHANGE_DHE_PSK=0      # Remove DHE-PSK (not used, saves flash)
      - -D CONFIG_MBEDTLS_KEY_EXCHANGE_ECDHE_ECDSA=1  # Keep ECDHE-ECDSA (used in modern TLS certs)
      - -D CONFIG_MBEDTLS_KEY_EXCHANGE_PSK=0          # Remove PSK (not used, saves flash)
      - -D CONFIG_MBEDTLS_SSL_MAX_CONTENT_LEN=4096    # Reduce TLS buffer size (saves RAM & flash)
      - -D CONFIG_TCP_MAX_SYN_RETRIES=3               # Reduce TCP retry count (smaller TCP stack)

# improv_serial:
#   id: serial_improv

# logger:
#   baud_rate: 115200

ota:
  - id: !extend ota_std
    password: !remove

script:
  - id: !extend dump_config_packages  # Defined by nspanel_esphome_core_base.yaml
    then:
      - lambda: |-
          ESP_LOGCONFIG("${project_tag}", "  - Pre-built (Wall Display)");

wifi:
  networks: !remove
  ap: {}
  power_save_mode: LIGHT  # To make it compatible with BLE
...
